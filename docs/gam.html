<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 GAM | Gaming under lockdown: Steam data</title>
  <meta name="description" content="4 GAM | Gaming under lockdown: Steam data" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 GAM | Gaming under lockdown: Steam data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 GAM | Gaming under lockdown: Steam data" />
  
  
  

<meta name="author" content="Matti Vuorre" />


<meta name="date" content="2020-10-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="describe-the-data.html"/>

<script src="libs/header-attrs-2.4.0/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Gaming under lockdown</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#analyses-and-reproducibility"><i class="fa fa-check"></i><b>1.1</b> Analyses and reproducibility</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#raw-data"><i class="fa fa-check"></i><b>1.2</b> Raw data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i><b>1.3</b> Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>2</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preprocessing.html"><a href="preprocessing.html#read-data"><i class="fa fa-check"></i><b>2.1</b> Read data</a></li>
<li class="chapter" data-level="2.2" data-path="preprocessing.html"><a href="preprocessing.html#dates"><i class="fa fa-check"></i><b>2.2</b> Dates</a></li>
<li class="chapter" data-level="2.3" data-path="preprocessing.html"><a href="preprocessing.html#coding"><i class="fa fa-check"></i><b>2.3</b> Coding</a></li>
<li class="chapter" data-level="2.4" data-path="preprocessing.html"><a href="preprocessing.html#save"><i class="fa fa-check"></i><b>2.4</b> Save</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="describe-the-data.html"><a href="describe-the-data.html"><i class="fa fa-check"></i><b>3</b> Describe the data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="describe-the-data.html"><a href="describe-the-data.html#features"><i class="fa fa-check"></i><b>3.1</b> Features</a></li>
<li class="chapter" data-level="3.2" data-path="describe-the-data.html"><a href="describe-the-data.html#titles"><i class="fa fa-check"></i><b>3.2</b> Titles</a></li>
<li class="chapter" data-level="3.3" data-path="describe-the-data.html"><a href="describe-the-data.html#total-volume"><i class="fa fa-check"></i><b>3.3</b> Total volume</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gam.html"><a href="gam.html"><i class="fa fa-check"></i><b>4</b> GAM</a>
<ul>
<li class="chapter" data-level="4.1" data-path="gam.html"><a href="gam.html#model-totals"><i class="fa fa-check"></i><b>4.1</b> Model totals</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="gam.html"><a href="gam.html#mgcv"><i class="fa fa-check"></i><b>4.1.1</b> mgcv</a></li>
<li class="chapter" data-level="4.1.2" data-path="gam.html"><a href="gam.html#brms"><i class="fa fa-check"></i><b>4.1.2</b> brms</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="gam.html"><a href="gam.html#multiplayer"><i class="fa fa-check"></i><b>4.2</b> Multiplayer</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="gam.html"><a href="gam.html#mgcv-1"><i class="fa fa-check"></i><b>4.2.1</b> mgcv</a></li>
<li class="chapter" data-level="4.2.2" data-path="gam.html"><a href="gam.html#brms-1"><i class="fa fa-check"></i><b>4.2.2</b> brms</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Gaming under lockdown: Steam data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gam" class="section level1" number="4">
<h1><span class="header-section-number">4</span> GAM</h1>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="gam.html#cb42-1"></a><span class="co"># Plotting options</span></span>
<span id="cb42-2"><a href="gam.html#cb42-2"></a><span class="kw">theme_set</span>(</span>
<span id="cb42-3"><a href="gam.html#cb42-3"></a>  <span class="kw">theme_linedraw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</span>
<span id="cb42-4"><a href="gam.html#cb42-4"></a>)</span>
<span id="cb42-5"><a href="gam.html#cb42-5"></a><span class="co"># Modelling options (cores, directory to save model files)</span></span>
<span id="cb42-6"><a href="gam.html#cb42-6"></a>ncores &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">detectCores</span>(<span class="dt">logical =</span> <span class="ot">FALSE</span>)</span>
<span id="cb42-7"><a href="gam.html#cb42-7"></a><span class="kw">options</span>(<span class="dt">mc.cores =</span> ncores, <span class="dt">loo.cores =</span> ncores)</span>
<span id="cb42-8"><a href="gam.html#cb42-8"></a><span class="kw">dir.create</span>(<span class="st">&quot;models&quot;</span>, <span class="ot">FALSE</span>)</span>
<span id="cb42-9"><a href="gam.html#cb42-9"></a><span class="co"># knitr options</span></span>
<span id="cb42-10"><a href="gam.html#cb42-10"></a>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">echo =</span> <span class="ot">TRUE</span>, <span class="dt">message =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>GAM</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="gam.html#cb43-1"></a>dat &lt;-<span class="st"> </span><span class="kw">left_join</span>(</span>
<span id="cb43-2"><a href="gam.html#cb43-2"></a>  <span class="kw">read_rds</span>(<span class="st">&quot;data/titles.rds&quot;</span>), </span>
<span id="cb43-3"><a href="gam.html#cb43-3"></a>  <span class="kw">read_rds</span>(<span class="st">&quot;data/players.rds&quot;</span>)</span>
<span id="cb43-4"><a href="gam.html#cb43-4"></a>)</span>
<span id="cb43-5"><a href="gam.html#cb43-5"></a></span>
<span id="cb43-6"><a href="gam.html#cb43-6"></a><span class="co"># Add useful time indicators</span></span>
<span id="cb43-7"><a href="gam.html#cb43-7"></a>cd &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-03-11&quot;</span>)</span>
<span id="cb43-8"><a href="gam.html#cb43-8"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-9"><a href="gam.html#cb43-9"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb43-10"><a href="gam.html#cb43-10"></a>    <span class="dt">year =</span> <span class="kw">factor</span>(<span class="kw">year</span>(Date)),</span>
<span id="cb43-11"><a href="gam.html#cb43-11"></a>    <span class="dt">ymonth =</span> <span class="kw">month</span>(Date, <span class="dt">label =</span> <span class="ot">FALSE</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb43-12"><a href="gam.html#cb43-12"></a>    <span class="dt">yweek =</span> <span class="kw">week</span>(Date) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb43-13"><a href="gam.html#cb43-13"></a>    <span class="dt">yday =</span> <span class="kw">yday</span>(Date) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb43-14"><a href="gam.html#cb43-14"></a>    <span class="dt">wday =</span> <span class="kw">wday</span>(Date, <span class="dt">week_start =</span> <span class="dv">1</span>, <span class="dt">label =</span> <span class="ot">FALSE</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb43-15"><a href="gam.html#cb43-15"></a>    <span class="dt">wend =</span> <span class="kw">factor</span>(<span class="kw">as.numeric</span>(wday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>)), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb43-16"><a href="gam.html#cb43-16"></a>  )</span>
<span id="cb43-17"><a href="gam.html#cb43-17"></a><span class="co"># Limit both years to last yday in 2020</span></span>
<span id="cb43-18"><a href="gam.html#cb43-18"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yday <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(yday[year<span class="op">==</span><span class="dv">2020</span>]))</span>
<span id="cb43-19"><a href="gam.html#cb43-19"></a><span class="kw">group_by</span>(dat, year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-20"><a href="gam.html#cb43-20"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">max</span>(Date))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   year  `max(Date)`
##   &lt;fct&gt; &lt;date&gt;     
## 1 2019  2019-07-15 
## 2 2020  2020-07-14</code></pre>
<div id="model-totals" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Model totals</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="gam.html#cb45-1"></a>total &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-2"><a href="gam.html#cb45-2"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="kw">across</span>(<span class="kw">c</span>(Date, year<span class="op">:</span>wend))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-3"><a href="gam.html#cb45-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb45-4"><a href="gam.html#cb45-4"></a>    <span class="dt">Players =</span> <span class="kw">sum</span>(Players, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </span>
<span id="cb45-5"><a href="gam.html#cb45-5"></a>    <span class="dt">ngames =</span> <span class="kw">length</span>(<span class="kw">unique</span>(appid))</span>
<span id="cb45-6"><a href="gam.html#cb45-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-7"><a href="gam.html#cb45-7"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb45-8"><a href="gam.html#cb45-8"></a>years &lt;-<span class="st"> </span>total <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-9"><a href="gam.html#cb45-9"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-10"><a href="gam.html#cb45-10"></a><span class="st">  </span><span class="kw">nest</span>()</span></code></pre></div>
<div id="mgcv" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> mgcv</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="gam.html#cb46-1"></a>years &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb46-2"><a href="gam.html#cb46-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb46-3"><a href="gam.html#cb46-3"></a>    <span class="dt">m0 =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">gamm</span>(</span>
<span id="cb46-4"><a href="gam.html#cb46-4"></a>      Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, <span class="dt">k =</span> <span class="dv">27</span>) <span class="op">+</span><span class="st"> </span><span class="kw">t2</span>(wday, <span class="dt">k =</span> <span class="dv">7</span>),</span>
<span id="cb46-5"><a href="gam.html#cb46-5"></a>      <span class="dt">data =</span> .x,</span>
<span id="cb46-6"><a href="gam.html#cb46-6"></a>      <span class="dt">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb46-7"><a href="gam.html#cb46-7"></a>    )),</span>
<span id="cb46-8"><a href="gam.html#cb46-8"></a>    <span class="dt">m1 =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">gamm</span>(</span>
<span id="cb46-9"><a href="gam.html#cb46-9"></a>      Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, wday, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">7</span>)),</span>
<span id="cb46-10"><a href="gam.html#cb46-10"></a>      <span class="dt">data =</span> .x,</span>
<span id="cb46-11"><a href="gam.html#cb46-11"></a>      <span class="dt">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb46-12"><a href="gam.html#cb46-12"></a>    ))</span>
<span id="cb46-13"><a href="gam.html#cb46-13"></a>  )</span>
<span id="cb46-14"><a href="gam.html#cb46-14"></a><span class="kw">anova</span>(</span>
<span id="cb46-15"><a href="gam.html#cb46-15"></a>  years<span class="op">$</span>m0[[<span class="dv">2</span>]][[<span class="st">&quot;lme&quot;</span>]], </span>
<span id="cb46-16"><a href="gam.html#cb46-16"></a>  years<span class="op">$</span>m1[[<span class="dv">2</span>]][[<span class="st">&quot;lme&quot;</span>]]</span>
<span id="cb46-17"><a href="gam.html#cb46-17"></a>)</span></code></pre></div>
<pre><code>##                        Model df      AIC      BIC    logLik   Test  L.Ratio
## years$m0[[2]][[&quot;lme&quot;]]     1  6 5162.805 5182.381 -2575.403                
## years$m1[[2]][[&quot;lme&quot;]]     2  8 5132.825 5158.884 -2558.412 1 vs 2 33.98069
##                        p-value
## years$m0[[2]][[&quot;lme&quot;]]        
## years$m1[[2]][[&quot;lme&quot;]]  &lt;.0001</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="gam.html#cb48-1"></a><span class="kw">summary</span>(years<span class="op">$</span>m1[[<span class="dv">2</span>]][[<span class="st">&quot;gam&quot;</span>]])</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Players ~ t2(yday, wday, k = c(27, 7))
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4491388       6047   742.8   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                 edf Ref.df    F p-value    
## t2(yday,wday) 57.02  57.02 53.4  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.974   
##   Scale est. = 7.1659e+09  n = 196</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="gam.html#cb50-1"></a><span class="kw">acf</span>(<span class="kw">residuals</span>(years<span class="op">$</span>m1[[<span class="dv">2</span>]][[<span class="st">&quot;gam&quot;</span>]]))</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/mgcv-years-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="gam.html#cb51-1"></a><span class="kw">gam.check</span>(years<span class="op">$</span>m1[[<span class="dv">2</span>]][[<span class="st">&quot;gam&quot;</span>]])</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/mgcv-years-2.png" width="672" /></p>
<pre><code>## 
## &#39;gamm&#39; based fit - care required with interpretation.
## Checks based on working residuals may be misleading.
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                k&#39; edf k-index p-value
## t2(yday,wday) 188  57    1.17       1</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="gam.html#cb53-1"></a><span class="kw">vis.gam</span>(years<span class="op">$</span>m1[[<span class="dv">1</span>]][[<span class="st">&quot;gam&quot;</span>]], <span class="dt">theta =</span> <span class="dv">30</span>, <span class="dt">phi =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/mgcv-years-3.png" width="672" /></p>
<p>Figure</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="gam.html#cb54-1"></a><span class="co"># Prediction dataframe</span></span>
<span id="cb54-2"><a href="gam.html#cb54-2"></a>tmp &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-3"><a href="gam.html#cb54-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb54-4"><a href="gam.html#cb54-4"></a>    <span class="dt">preds =</span> <span class="kw">map</span>(m1, <span class="op">~</span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(.x[[<span class="st">&quot;gam&quot;</span>]], <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)))</span>
<span id="cb54-5"><a href="gam.html#cb54-5"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-6"><a href="gam.html#cb54-6"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(data, preds)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-7"><a href="gam.html#cb54-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-8"><a href="gam.html#cb54-8"></a><span class="st">  </span><span class="co"># Make dates same for 2019 and 2020 to put on same plot</span></span>
<span id="cb54-9"><a href="gam.html#cb54-9"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-10"><a href="gam.html#cb54-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-11"><a href="gam.html#cb54-11"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb54-12"><a href="gam.html#cb54-12"></a><span class="co"># Excess players dataframe</span></span>
<span id="cb54-13"><a href="gam.html#cb54-13"></a>tmp2 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-14"><a href="gam.html#cb54-14"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, Players, fit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-15"><a href="gam.html#cb54-15"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb54-16"><a href="gam.html#cb54-16"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(Players, fit), <span class="dt">values_fn =</span> mean</span>
<span id="cb54-17"><a href="gam.html#cb54-17"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-18"><a href="gam.html#cb54-18"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_empirical =</span> Players_<span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>Players_<span class="dv">2019</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-19"><a href="gam.html#cb54-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_model =</span> fit_<span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>fit_<span class="dv">2019</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-20"><a href="gam.html#cb54-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-21"><a href="gam.html#cb54-21"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, <span class="kw">starts_with</span>(<span class="st">&quot;excess&quot;</span>))</span>
<span id="cb54-22"><a href="gam.html#cb54-22"></a>  <span class="co"># left_join(select(tmp, year, Date, yweek))</span></span>
<span id="cb54-23"><a href="gam.html#cb54-23"></a><span class="co"># Predictions and data figure</span></span>
<span id="cb54-24"><a href="gam.html#cb54-24"></a>p1 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span></span>
<span id="cb54-25"><a href="gam.html#cb54-25"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Date, Players, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb54-26"><a href="gam.html#cb54-26"></a><span class="st">  </span><span class="co"># scale_x_date() +</span></span>
<span id="cb54-27"><a href="gam.html#cb54-27"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> cd, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb54-28"><a href="gam.html#cb54-28"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb54-29"><a href="gam.html#cb54-29"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) <span class="op">+</span></span>
<span id="cb54-30"><a href="gam.html#cb54-30"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb54-31"><a href="gam.html#cb54-31"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb54-32"><a href="gam.html#cb54-32"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb54-33"><a href="gam.html#cb54-33"></a>  ) <span class="op">+</span></span>
<span id="cb54-34"><a href="gam.html#cb54-34"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb54-35"><a href="gam.html#cb54-35"></a>    <span class="kw">aes</span>(<span class="dt">ymin =</span> fit<span class="op">-</span>se.fit<span class="op">*</span><span class="dv">2</span>, <span class="dt">ymax =</span> fit<span class="op">+</span>se.fit<span class="op">*</span><span class="dv">2</span>), <span class="dt">alpha=</span>.<span class="dv">1</span></span>
<span id="cb54-36"><a href="gam.html#cb54-36"></a>  ) <span class="op">+</span></span>
<span id="cb54-37"><a href="gam.html#cb54-37"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>fit), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb54-38"><a href="gam.html#cb54-38"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb54-39"><a href="gam.html#cb54-39"></a>p1</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="gam.html#cb55-1"></a><span class="co"># Excess gaming figure  </span></span>
<span id="cb55-2"><a href="gam.html#cb55-2"></a>p2 &lt;-<span class="st"> </span>tmp2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-3"><a href="gam.html#cb55-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yweek, <span class="dt">alpha =</span> <span class="ot">NA</span>)) <span class="op">+</span></span>
<span id="cb55-4"><a href="gam.html#cb55-4"></a><span class="st">  </span><span class="co"># Week of WHO announcement</span></span>
<span id="cb55-5"><a href="gam.html#cb55-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb55-6"><a href="gam.html#cb55-6"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb55-7"><a href="gam.html#cb55-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> excess_model), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb55-8"><a href="gam.html#cb55-8"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb55-9"><a href="gam.html#cb55-9"></a>    <span class="kw">aes</span>(<span class="dt">y =</span> excess_empirical), </span>
<span id="cb55-10"><a href="gam.html#cb55-10"></a>    <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb55-11"><a href="gam.html#cb55-11"></a>  ) <span class="op">+</span></span>
<span id="cb55-12"><a href="gam.html#cb55-12"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb55-13"><a href="gam.html#cb55-13"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb55-14"><a href="gam.html#cb55-14"></a>    <span class="st">&quot;Excess players</span><span class="ch">\n</span><span class="st">(2020 - 2019)&quot;</span>,</span>
<span id="cb55-15"><a href="gam.html#cb55-15"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb55-16"><a href="gam.html#cb55-16"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb55-17"><a href="gam.html#cb55-17"></a>  )</span>
<span id="cb55-18"><a href="gam.html#cb55-18"></a>p2</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="gam.html#cb57-1"></a>(p1 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())) <span class="op">/</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></span>
<span id="cb57-2"><a href="gam.html#cb57-2"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">75</span>, <span class="fl">.25</span>), <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="gam.html#cb59-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;Figure1-mgcv.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p>Weekend effect figure</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="gam.html#cb61-1"></a>years <span class="op">%&gt;%</span></span>
<span id="cb61-2"><a href="gam.html#cb61-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">preds =</span> <span class="kw">map</span>(m1, <span class="op">~</span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(.x[[<span class="st">&quot;gam&quot;</span>]], <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb61-3"><a href="gam.html#cb61-3"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(data, preds)) <span class="op">%&gt;%</span></span>
<span id="cb61-4"><a href="gam.html#cb61-4"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek) <span class="op">%&gt;%</span></span>
<span id="cb61-5"><a href="gam.html#cb61-5"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb61-6"><a href="gam.html#cb61-6"></a>    <span class="dt">w_eff =</span> <span class="kw">mean</span>(Players[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">6</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Players[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">4</span>]),</span>
<span id="cb61-7"><a href="gam.html#cb61-7"></a>    <span class="dt">fit =</span> <span class="kw">mean</span>(fit[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">6</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(fit[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">4</span>]),</span>
<span id="cb61-8"><a href="gam.html#cb61-8"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb61-9"><a href="gam.html#cb61-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-10"><a href="gam.html#cb61-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yweek, w_eff, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb61-11"><a href="gam.html#cb61-11"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(</span>
<span id="cb61-12"><a href="gam.html#cb61-12"></a>    <span class="st">&quot;Week number&quot;</span>,</span>
<span id="cb61-13"><a href="gam.html#cb61-13"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()</span>
<span id="cb61-14"><a href="gam.html#cb61-14"></a>  ) <span class="op">+</span></span>
<span id="cb61-15"><a href="gam.html#cb61-15"></a><span class="st">    </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb61-16"><a href="gam.html#cb61-16"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb61-17"><a href="gam.html#cb61-17"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb61-18"><a href="gam.html#cb61-18"></a>  ) <span class="op">+</span></span>
<span id="cb61-19"><a href="gam.html#cb61-19"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb61-20"><a href="gam.html#cb61-20"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>fit)) <span class="op">+</span></span>
<span id="cb61-21"><a href="gam.html#cb61-21"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="gam.html#cb62-1"></a><span class="co"># show it for weeks 5, 15, and 25</span></span>
<span id="cb62-2"><a href="gam.html#cb62-2"></a>years <span class="op">%&gt;%</span></span>
<span id="cb62-3"><a href="gam.html#cb62-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">preds =</span> <span class="kw">map</span>(m1, <span class="op">~</span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(.x[[<span class="st">&quot;gam&quot;</span>]], <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb62-4"><a href="gam.html#cb62-4"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(data, preds)) <span class="op">%&gt;%</span></span>
<span id="cb62-5"><a href="gam.html#cb62-5"></a><span class="st">  </span><span class="kw">filter</span>(yweek <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">25</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-6"><a href="gam.html#cb62-6"></a><span class="st">  </span><span class="co"># group_by(year, yweek, yday) %&gt;%</span></span>
<span id="cb62-7"><a href="gam.html#cb62-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-8"><a href="gam.html#cb62-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(wday, Players)) <span class="op">+</span></span>
<span id="cb62-9"><a href="gam.html#cb62-9"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb62-10"><a href="gam.html#cb62-10"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> fit)) <span class="op">+</span></span>
<span id="cb62-11"><a href="gam.html#cb62-11"></a><span class="st">  </span><span class="kw">facet_grid</span>(year<span class="op">~</span>yweek)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
</div>
<div id="brms" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> brms</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="gam.html#cb63-1"></a>sampler_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">brm</span>(</span>
<span id="cb63-2"><a href="gam.html#cb63-2"></a>  Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, <span class="dt">k =</span> <span class="dv">27</span>) <span class="op">+</span><span class="st"> </span><span class="kw">t2</span>(wday, <span class="dt">k =</span> <span class="dv">7</span>),</span>
<span id="cb63-3"><a href="gam.html#cb63-3"></a>  <span class="co"># prior = prior(normal(4.5e6, 5e5), class = &quot;Intercept&quot;),</span></span>
<span id="cb63-4"><a href="gam.html#cb63-4"></a>  <span class="dt">data =</span> <span class="kw">filter</span>(total, year<span class="op">==</span><span class="dv">2020</span>),</span>
<span id="cb63-5"><a href="gam.html#cb63-5"></a>  <span class="dt">chains =</span> <span class="dv">0</span>,</span>
<span id="cb63-6"><a href="gam.html#cb63-6"></a>  <span class="dt">file =</span> <span class="st">&quot;models/brm-sampler-0&quot;</span></span>
<span id="cb63-7"><a href="gam.html#cb63-7"></a>)</span>
<span id="cb63-8"><a href="gam.html#cb63-8"></a>sampler_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">brm</span>(</span>
<span id="cb63-9"><a href="gam.html#cb63-9"></a>  Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, wday, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">7</span>)),</span>
<span id="cb63-10"><a href="gam.html#cb63-10"></a>  <span class="co"># prior = prior(normal(4.5e6, 1e5), class = &quot;Intercept&quot;),</span></span>
<span id="cb63-11"><a href="gam.html#cb63-11"></a>  <span class="dt">data =</span> <span class="kw">filter</span>(total, year<span class="op">==</span><span class="dv">2020</span>),</span>
<span id="cb63-12"><a href="gam.html#cb63-12"></a>  <span class="dt">chains =</span> <span class="dv">0</span>,</span>
<span id="cb63-13"><a href="gam.html#cb63-13"></a>  <span class="dt">file =</span> <span class="st">&quot;models/brm-sampler-1&quot;</span></span>
<span id="cb63-14"><a href="gam.html#cb63-14"></a>)</span>
<span id="cb63-15"><a href="gam.html#cb63-15"></a>sampler_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">brm</span>(</span>
<span id="cb63-16"><a href="gam.html#cb63-16"></a>  Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, wday, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">7</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ar</span>(<span class="dt">time =</span> yday, <span class="dt">p =</span> <span class="dv">1</span>),</span>
<span id="cb63-17"><a href="gam.html#cb63-17"></a>  <span class="co"># prior = prior(normal(4.5e6, 1e5), class = &quot;Intercept&quot;),</span></span>
<span id="cb63-18"><a href="gam.html#cb63-18"></a>  <span class="dt">data =</span> <span class="kw">filter</span>(total, year<span class="op">==</span><span class="dv">2020</span>),</span>
<span id="cb63-19"><a href="gam.html#cb63-19"></a>  <span class="dt">chains =</span> <span class="dv">0</span>,</span>
<span id="cb63-20"><a href="gam.html#cb63-20"></a>  <span class="dt">file =</span> <span class="st">&quot;models/brm-sampler-2&quot;</span></span>
<span id="cb63-21"><a href="gam.html#cb63-21"></a>)</span>
<span id="cb63-22"><a href="gam.html#cb63-22"></a><span class="co"># This model has a hard time converging so we set inits for the intercept</span></span>
<span id="cb63-23"><a href="gam.html#cb63-23"></a>years &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb63-24"><a href="gam.html#cb63-24"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb63-25"><a href="gam.html#cb63-25"></a>    <span class="dt">bm0 =</span> <span class="kw">map2</span>(data, year, <span class="op">~</span><span class="kw">update</span>(</span>
<span id="cb63-26"><a href="gam.html#cb63-26"></a>      sampler_<span class="dv">0</span>,</span>
<span id="cb63-27"><a href="gam.html#cb63-27"></a>      <span class="dt">newdata =</span> .x,</span>
<span id="cb63-28"><a href="gam.html#cb63-28"></a>      <span class="dt">chains =</span> <span class="dv">4</span>,</span>
<span id="cb63-29"><a href="gam.html#cb63-29"></a>      <span class="dt">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb63-30"><a href="gam.html#cb63-30"></a>      <span class="dt">inits =</span> <span class="cf">function</span>() {<span class="kw">list</span>(<span class="dt">Intercept =</span> <span class="fl">4.5e6</span>)},</span>
<span id="cb63-31"><a href="gam.html#cb63-31"></a>      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</span>
<span id="cb63-32"><a href="gam.html#cb63-32"></a>      <span class="dt">file =</span> <span class="kw">str_glue</span>(<span class="st">&quot;models/brm-{.y}-m0&quot;</span>)</span>
<span id="cb63-33"><a href="gam.html#cb63-33"></a>    )),</span>
<span id="cb63-34"><a href="gam.html#cb63-34"></a>    <span class="dt">bm1 =</span> <span class="kw">map2</span>(data, year, <span class="op">~</span><span class="kw">update</span>(</span>
<span id="cb63-35"><a href="gam.html#cb63-35"></a>      sampler_<span class="dv">1</span>,</span>
<span id="cb63-36"><a href="gam.html#cb63-36"></a>      <span class="dt">newdata =</span> .x,</span>
<span id="cb63-37"><a href="gam.html#cb63-37"></a>      <span class="dt">chains =</span> <span class="dv">4</span>,</span>
<span id="cb63-38"><a href="gam.html#cb63-38"></a>      <span class="dt">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb63-39"><a href="gam.html#cb63-39"></a>      <span class="dt">inits =</span> <span class="cf">function</span>() {<span class="kw">list</span>(<span class="dt">Intercept =</span> <span class="fl">4.5e6</span>)},</span>
<span id="cb63-40"><a href="gam.html#cb63-40"></a>      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</span>
<span id="cb63-41"><a href="gam.html#cb63-41"></a>      <span class="dt">file =</span> <span class="kw">str_glue</span>(<span class="st">&quot;models/brm-{.y}-m1&quot;</span>)</span>
<span id="cb63-42"><a href="gam.html#cb63-42"></a>    )),</span>
<span id="cb63-43"><a href="gam.html#cb63-43"></a>    <span class="dt">bm2 =</span> <span class="kw">map2</span>(data, year, <span class="op">~</span><span class="kw">update</span>(</span>
<span id="cb63-44"><a href="gam.html#cb63-44"></a>      sampler_<span class="dv">2</span>,</span>
<span id="cb63-45"><a href="gam.html#cb63-45"></a>      <span class="dt">newdata =</span> .x,</span>
<span id="cb63-46"><a href="gam.html#cb63-46"></a>      <span class="dt">chains =</span> <span class="dv">4</span>,</span>
<span id="cb63-47"><a href="gam.html#cb63-47"></a>      <span class="dt">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb63-48"><a href="gam.html#cb63-48"></a>      <span class="dt">inits =</span> <span class="cf">function</span>() {<span class="kw">list</span>(<span class="dt">Intercept =</span> <span class="fl">4.5e6</span>)},</span>
<span id="cb63-49"><a href="gam.html#cb63-49"></a>      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</span>
<span id="cb63-50"><a href="gam.html#cb63-50"></a>      <span class="dt">file =</span> <span class="kw">str_glue</span>(<span class="st">&quot;models/brm-{.y}-m2&quot;</span>)</span>
<span id="cb63-51"><a href="gam.html#cb63-51"></a>    ))</span>
<span id="cb63-52"><a href="gam.html#cb63-52"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="gam.html#cb64-1"></a><span class="kw">map</span>(years<span class="op">$</span>bm0, summary)</span></code></pre></div>
<pre><code>## [[1]]
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, k = 27) + t2(wday, k = 7) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                 Estimate  Est.Error  l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## sds(t2yday_1) 3140375.41 1931596.04 688118.17 7245725.75 1.01      410     1498
## sds(t2wday_1)  698957.62  246675.28 366244.83 1312733.38 1.00     1949     3205
## 
## Population-Level Effects: 
##             Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept 4131476.19   8643.19 4114591.68 4148408.74 1.00     9252     6132
## t2yday_1   137335.09   9750.69  118022.14  155865.67 1.00     2222     4234
## t2wday_1   209829.48   8577.12  192847.56  226648.96 1.00     9171     4882
## 
## Family Specific Parameters: 
##        Estimate Est.Error  l-95% CI  u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 118933.33   9617.86 101855.88 138252.44 1.01      599     2491
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).
## 
## [[2]]
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, k = 27) + t2(wday, k = 7) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                 Estimate  Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS
## sds(t2yday_1) 5933923.97 1009065.17 4237181.33 8237091.24 1.00     1437
## sds(t2wday_1)  642551.30  242753.01  323810.00 1251140.93 1.00     2150
##               Tail_ESS
## sds(t2yday_1)     2296
## sds(t2wday_1)     3306
## 
## Population-Level Effects: 
##             Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept 4485180.91   8477.84 4468364.43 4501760.77 1.00    11132     6134
## t2yday_1   -73684.26   9055.69  -91925.39  -55772.09 1.00    10429     6521
## t2wday_1   183460.42   8299.92  167425.26  199806.65 1.00    12741     5561
## 
## Family Specific Parameters: 
##        Estimate Est.Error  l-95% CI  u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 116553.07   6500.28 104534.40 129848.53 1.00     8073     6257
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="gam.html#cb66-1"></a><span class="kw">gam.vcomp</span>(years<span class="op">$</span>m0[[<span class="dv">2</span>]][[<span class="st">&quot;gam&quot;</span>]], <span class="dt">rescale =</span> <span class="ot">FALSE</span>) <span class="co"># Compare</span></span></code></pre></div>
<pre><code>##  t2(yday)  t2(wday) 
## 6241236.8  572271.5</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="gam.html#cb68-1"></a><span class="kw">map</span>(years<span class="op">$</span>bm1, summary)</span></code></pre></div>
<pre><code>## [[1]]
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, wday, k = c(27, 7)) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                     Estimate  Est.Error   l-95% CI    u-95% CI Rhat Bulk_ESS
## sds(t2ydaywday_1)  215594.09  160732.73   10966.17   613935.53 1.00     3118
## sds(t2ydaywday_2) 7204025.68 1860116.51 4387471.72 11475105.87 1.00     2447
## sds(t2ydaywday_3) 4514113.25 2321947.75 2216629.37  8742885.48 1.00     1163
##                   Tail_ESS
## sds(t2ydaywday_1)     3242
## sds(t2ydaywday_2)     4008
## sds(t2ydaywday_3)     1068
## 
## Population-Level Effects: 
##                Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    4132036.59   8570.93 4114941.77 4148743.71 1.00    10695     4926
## t2ydaywday_1  205090.46   8417.92  188912.33  221417.15 1.00    13259     5615
## t2ydaywday_2 -130363.57   8650.15 -147152.68 -113497.56 1.00     9735     5780
## t2ydaywday_3   42352.34   8706.46   25321.94   59220.76 1.00    11427     6096
## 
## Family Specific Parameters: 
##        Estimate Est.Error  l-95% CI  u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 116569.17   7491.92 102658.87 131697.39 1.00     2104     1526
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).
## 
## [[2]]
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, wday, k = c(27, 7)) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                      Estimate  Est.Error    l-95% CI    u-95% CI Rhat Bulk_ESS
## sds(t2ydaywday_1)   559894.76  235059.21   140808.47  1101095.34 1.00     2039
## sds(t2ydaywday_2)  6540650.59 1665083.83  4031383.32 10495088.39 1.00     2246
## sds(t2ydaywday_3) 28904897.04 3778821.37 22340552.86 37229776.95 1.00     1289
##                   Tail_ESS
## sds(t2ydaywday_1)     1957
## sds(t2ydaywday_2)     3394
## sds(t2ydaywday_3)     2573
## 
## Population-Level Effects: 
##                Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    4485869.84   6444.76 4473136.35 4498590.03 1.00    13886     5987
## t2ydaywday_1  177276.87   6593.10  164357.20  190136.28 1.00     9544     5744
## t2ydaywday_2   74333.12   7011.04   60732.48   88125.07 1.00     9869     6174
## t2ydaywday_3   43303.65   7376.32   28865.14   57713.36 1.00     6988     5815
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 86674.84   5898.27 76036.38 99046.65 1.00     3792     5218
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="gam.html#cb70-1"></a><span class="kw">map</span>(years<span class="op">$</span>bm2, summary)</span></code></pre></div>
<pre><code>## [[1]]
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, wday, k = c(27, 7)) + ar(time = yday, p = 1) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                     Estimate  Est.Error   l-95% CI    u-95% CI Rhat Bulk_ESS
## sds(t2ydaywday_1)  178364.82  131989.59    7522.88   499142.17 1.00     2966
## sds(t2ydaywday_2) 7978386.63 1743393.33 5263770.16 12184139.14 1.00     1548
## sds(t2ydaywday_3)  844954.99  538037.73  105225.67  2172772.92 1.00     1336
##                   Tail_ESS
## sds(t2ydaywday_1)     3707
## sds(t2ydaywday_2)     3071
## sds(t2ydaywday_3)     2218
## 
## Correlation Structures:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## ar[1]     0.79      0.09     0.64     0.98 1.00     1469     1040
## 
## Population-Level Effects: 
##                Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    4170243.96  94248.66 4088092.69 4398734.11 1.00     1780      761
## t2ydaywday_1  203991.02   7453.18  189171.13  218760.86 1.00     9630     6054
## t2ydaywday_2 -182351.83  67708.61 -361790.84 -106738.92 1.00     1991     1819
## t2ydaywday_3   40049.02   7570.60   25359.75   54725.30 1.00     7120     6084
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI  u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 96083.71   5417.89 86102.29 107405.21 1.00     4183     5190
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).
## 
## [[2]]
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, wday, k = c(27, 7)) + ar(time = yday, p = 1) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                     Estimate  Est.Error   l-95% CI    u-95% CI Rhat Bulk_ESS
## sds(t2ydaywday_1)  522266.78  224319.32  120551.33  1018342.66 1.00     2170
## sds(t2ydaywday_2) 6897256.71 1623665.15 4424409.11 10543378.73 1.00     2608
## sds(t2ydaywday_3)  645611.57  409913.36   40178.70  1614495.05 1.00     2589
##                   Tail_ESS
## sds(t2ydaywday_1)     1878
## sds(t2ydaywday_2)     3914
## sds(t2ydaywday_3)     2349
## 
## Correlation Structures:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## ar[1]     0.98      0.02     0.95     1.01 1.00     4148     5574
## 
## Population-Level Effects: 
##                Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    4460016.96 370265.05 3718170.05 5231356.80 1.00     1477     1158
## t2ydaywday_1  178746.71   8163.91  162417.60  194251.11 1.00    13462     6239
## t2ydaywday_2  -41314.31 223588.54 -490180.26  429033.04 1.00     1556     1214
## t2ydaywday_3   46970.56   8355.87   30582.92   63518.83 1.00    10271     6705
## 
## Family Specific Parameters: 
##        Estimate Est.Error  l-95% CI  u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 113139.79   6443.98 101533.87 126729.09 1.00     7651     6018
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="gam.html#cb72-1"></a><span class="kw">gam.vcomp</span>(years<span class="op">$</span>m1[[<span class="dv">2</span>]][[<span class="st">&quot;gam&quot;</span>]], <span class="dt">rescale =</span> <span class="ot">FALSE</span>) <span class="co"># Compare</span></span></code></pre></div>
<pre><code>## t2(yday,wday)rr t2(yday,wday)nr t2(yday,wday)rn 
##        570590.4       7319951.8      30036034.6</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="gam.html#cb74-1"></a><span class="kw">cbind</span>(years<span class="op">$</span>bm1[[<span class="dv">2</span>]][[<span class="st">&quot;data&quot;</span>]], <span class="kw">fitted</span>(years<span class="op">$</span>bm1[[<span class="dv">2</span>]])) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb74-2"><a href="gam.html#cb74-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yday, Players)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb74-3"><a href="gam.html#cb74-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb74-4"><a href="gam.html#cb74-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate))</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="gam.html#cb75-1"></a><span class="kw">acf</span>(<span class="kw">residuals</span>(years<span class="op">$</span>bm1[[<span class="dv">2</span>]])[,<span class="dv">1</span>])</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="gam.html#cb76-1"></a><span class="kw">summary</span>(years<span class="op">$</span>bm1[[<span class="dv">2</span>]])</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Players ~ t2(yday, wday, k = c(27, 7)) 
##    Data: .x (Number of observations: 196) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Smooth Terms: 
##                      Estimate  Est.Error    l-95% CI    u-95% CI Rhat Bulk_ESS
## sds(t2ydaywday_1)   559894.76  235059.21   140808.47  1101095.34 1.00     2039
## sds(t2ydaywday_2)  6540650.59 1665083.83  4031383.32 10495088.39 1.00     2246
## sds(t2ydaywday_3) 28904897.04 3778821.37 22340552.86 37229776.95 1.00     1289
##                   Tail_ESS
## sds(t2ydaywday_1)     1957
## sds(t2ydaywday_2)     3394
## sds(t2ydaywday_3)     2573
## 
## Population-Level Effects: 
##                Estimate Est.Error   l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    4485869.84   6444.76 4473136.35 4498590.03 1.00    13886     5987
## t2ydaywday_1  177276.87   6593.10  164357.20  190136.28 1.00     9544     5744
## t2ydaywday_2   74333.12   7011.04   60732.48   88125.07 1.00     9869     6174
## t2ydaywday_3   43303.65   7376.32   28865.14   57713.36 1.00     6988     5815
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 86674.84   5898.27 76036.38 99046.65 1.00     3792     5218
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="gam.html#cb78-1"></a><span class="kw">bayes_R2</span>(years<span class="op">$</span>bm1[[<span class="dv">2</span>]])</span></code></pre></div>
<pre><code>##     Estimate   Est.Error      Q2.5     Q97.5
## R2 0.9732051 0.002436581 0.9679154 0.9773106</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="gam.html#cb80-1"></a><span class="co"># Compare mgcv and brms</span></span>
<span id="cb80-2"><a href="gam.html#cb80-2"></a>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-3"><a href="gam.html#cb80-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb80-4"><a href="gam.html#cb80-4"></a>    <span class="dt">pred_b =</span> <span class="kw">map</span>(bm1, <span class="op">~</span><span class="kw">as.data.frame</span>(<span class="kw">fitted</span>(.))), </span>
<span id="cb80-5"><a href="gam.html#cb80-5"></a>    <span class="dt">pred_m =</span> <span class="kw">map</span>(m1, <span class="op">~</span><span class="kw">fitted</span>(.[[<span class="st">&quot;gam&quot;</span>]]))</span>
<span id="cb80-6"><a href="gam.html#cb80-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-7"><a href="gam.html#cb80-7"></a><span class="st">  </span><span class="kw">select</span>(year, data, <span class="kw">starts_with</span>(<span class="st">&quot;pred&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-8"><a href="gam.html#cb80-8"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(data, pred_m, pred_b)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-9"><a href="gam.html#cb80-9"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(Estimate, pred_m)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-10"><a href="gam.html#cb80-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Date, Players)) <span class="op">+</span></span>
<span id="cb80-11"><a href="gam.html#cb80-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb80-12"><a href="gam.html#cb80-12"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> value, <span class="dt">col =</span> name)) <span class="op">+</span></span>
<span id="cb80-13"><a href="gam.html#cb80-13"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;year&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div id="figure" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Figure</h4>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="gam.html#cb81-1"></a><span class="co"># Prediction dataframe</span></span>
<span id="cb81-2"><a href="gam.html#cb81-2"></a>tmp &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-3"><a href="gam.html#cb81-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb81-4"><a href="gam.html#cb81-4"></a>    <span class="dt">p =</span> <span class="kw">map2</span>(data, bm1, <span class="op">~</span><span class="kw">add_fitted_draws</span>(.x, .y))</span>
<span id="cb81-5"><a href="gam.html#cb81-5"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-6"><a href="gam.html#cb81-6"></a><span class="st">  </span><span class="kw">select</span>(year, p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-7"><a href="gam.html#cb81-7"></a><span class="st">  </span><span class="kw">unnest</span>(p)</span>
<span id="cb81-8"><a href="gam.html#cb81-8"></a></span>
<span id="cb81-9"><a href="gam.html#cb81-9"></a><span class="co"># Data with same dates for years for visualizing</span></span>
<span id="cb81-10"><a href="gam.html#cb81-10"></a>xtmp &lt;-<span class="st"> </span>total <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-11"><a href="gam.html#cb81-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-12"><a href="gam.html#cb81-12"></a><span class="st">  </span><span class="co"># Make dates same for 2019 and 2020 to put on same plot</span></span>
<span id="cb81-13"><a href="gam.html#cb81-13"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-14"><a href="gam.html#cb81-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-15"><a href="gam.html#cb81-15"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb81-16"><a href="gam.html#cb81-16"></a></span>
<span id="cb81-17"><a href="gam.html#cb81-17"></a><span class="co"># Predictions and data figure</span></span>
<span id="cb81-18"><a href="gam.html#cb81-18"></a>p1 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span></span>
<span id="cb81-19"><a href="gam.html#cb81-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-20"><a href="gam.html#cb81-20"></a><span class="st">  </span><span class="co"># Make dates same for 2019 and 2020 to put on same plot</span></span>
<span id="cb81-21"><a href="gam.html#cb81-21"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-22"><a href="gam.html#cb81-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-23"><a href="gam.html#cb81-23"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-24"><a href="gam.html#cb81-24"></a><span class="st">  </span><span class="kw">group_by</span>(year, Date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-25"><a href="gam.html#cb81-25"></a><span class="st">  </span><span class="kw">mean_qi</span>(.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-26"><a href="gam.html#cb81-26"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-27"><a href="gam.html#cb81-27"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Date, .value, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb81-28"><a href="gam.html#cb81-28"></a><span class="st">  </span><span class="co"># scale_x_date() +</span></span>
<span id="cb81-29"><a href="gam.html#cb81-29"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> cd, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb81-30"><a href="gam.html#cb81-30"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb81-31"><a href="gam.html#cb81-31"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) <span class="op">+</span></span>
<span id="cb81-32"><a href="gam.html#cb81-32"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb81-33"><a href="gam.html#cb81-33"></a>    <span class="st">&quot;Players&quot;</span>,</span>
<span id="cb81-34"><a href="gam.html#cb81-34"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb81-35"><a href="gam.html#cb81-35"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb81-36"><a href="gam.html#cb81-36"></a>  ) <span class="op">+</span></span>
<span id="cb81-37"><a href="gam.html#cb81-37"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb81-38"><a href="gam.html#cb81-38"></a>    <span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha=</span>.<span class="dv">1</span></span>
<span id="cb81-39"><a href="gam.html#cb81-39"></a>  ) <span class="op">+</span></span>
<span id="cb81-40"><a href="gam.html#cb81-40"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb81-41"><a href="gam.html#cb81-41"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb81-42"><a href="gam.html#cb81-42"></a>    <span class="dt">data =</span> xtmp, </span>
<span id="cb81-43"><a href="gam.html#cb81-43"></a>    <span class="kw">aes</span>(<span class="dt">y=</span>Players), <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb81-44"><a href="gam.html#cb81-44"></a>    )</span>
<span id="cb81-45"><a href="gam.html#cb81-45"></a>p1</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="gam.html#cb82-1"></a><span class="co"># Excess players dataframe</span></span>
<span id="cb82-2"><a href="gam.html#cb82-2"></a>tmp2 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-3"><a href="gam.html#cb82-3"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek, .draw) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-4"><a href="gam.html#cb82-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">week_mean =</span> <span class="kw">mean</span>(.value)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-5"><a href="gam.html#cb82-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">.draw =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-6"><a href="gam.html#cb82-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-7"><a href="gam.html#cb82-7"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb82-8"><a href="gam.html#cb82-8"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(week_mean)</span>
<span id="cb82-9"><a href="gam.html#cb82-9"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-10"><a href="gam.html#cb82-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_model =</span> <span class="st">`</span><span class="dt">2020</span><span class="st">`</span> <span class="op">/</span><span class="st"> `</span><span class="dt">2019</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-11"><a href="gam.html#cb82-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-12"><a href="gam.html#cb82-12"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, <span class="kw">starts_with</span>(<span class="st">&quot;excess&quot;</span>))</span>
<span id="cb82-13"><a href="gam.html#cb82-13"></a>tmp3 &lt;-<span class="st"> </span>xtmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-14"><a href="gam.html#cb82-14"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-15"><a href="gam.html#cb82-15"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">week_mean =</span> <span class="kw">mean</span>(Players)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-16"><a href="gam.html#cb82-16"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb82-17"><a href="gam.html#cb82-17"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(week_mean)</span>
<span id="cb82-18"><a href="gam.html#cb82-18"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-19"><a href="gam.html#cb82-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_data =</span> <span class="st">`</span><span class="dt">2020</span><span class="st">`</span> <span class="op">/</span><span class="st"> `</span><span class="dt">2019</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-20"><a href="gam.html#cb82-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-21"><a href="gam.html#cb82-21"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, <span class="kw">starts_with</span>(<span class="st">&quot;excess&quot;</span>))</span>
<span id="cb82-22"><a href="gam.html#cb82-22"></a>  <span class="co"># left_join(select(tmp, year, Date, yweek))</span></span>
<span id="cb82-23"><a href="gam.html#cb82-23"></a><span class="co"># Excess gaming figure  </span></span>
<span id="cb82-24"><a href="gam.html#cb82-24"></a>p2 &lt;-<span class="st"> </span>tmp2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-25"><a href="gam.html#cb82-25"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-26"><a href="gam.html#cb82-26"></a><span class="st">  </span><span class="kw">mean_qi</span>(excess_model) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-27"><a href="gam.html#cb82-27"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yweek, <span class="dt">alpha =</span> <span class="ot">NA</span>)) <span class="op">+</span></span>
<span id="cb82-28"><a href="gam.html#cb82-28"></a><span class="st">  </span><span class="co"># Week of WHO announcement</span></span>
<span id="cb82-29"><a href="gam.html#cb82-29"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb82-30"><a href="gam.html#cb82-30"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb82-31"><a href="gam.html#cb82-31"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb82-32"><a href="gam.html#cb82-32"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> excess_model), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb82-33"><a href="gam.html#cb82-33"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb82-34"><a href="gam.html#cb82-34"></a>    <span class="dt">data =</span> tmp3,</span>
<span id="cb82-35"><a href="gam.html#cb82-35"></a>    <span class="kw">aes</span>(<span class="dt">y =</span> excess_data),</span>
<span id="cb82-36"><a href="gam.html#cb82-36"></a>    <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb82-37"><a href="gam.html#cb82-37"></a>  ) <span class="op">+</span></span>
<span id="cb82-38"><a href="gam.html#cb82-38"></a><span class="st">  </span><span class="co"># geom_hline(yintercept = 0, lty = 2, size = .1) +</span></span>
<span id="cb82-39"><a href="gam.html#cb82-39"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb82-40"><a href="gam.html#cb82-40"></a>    <span class="st">&quot;Excess players in 2020&quot;</span>,</span>
<span id="cb82-41"><a href="gam.html#cb82-41"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(),</span>
<span id="cb82-42"><a href="gam.html#cb82-42"></a>    <span class="dt">labels =</span> scales<span class="op">::</span>percent</span>
<span id="cb82-43"><a href="gam.html#cb82-43"></a>  )</span>
<span id="cb82-44"><a href="gam.html#cb82-44"></a>p2</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="gam.html#cb84-1"></a>(p1 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())) <span class="op">/</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></span>
<span id="cb84-2"><a href="gam.html#cb84-2"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">75</span>, <span class="fl">.25</span>), <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="gam.html#cb86-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;Figure1-brms.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div id="weekend-effect" class="section level4" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Weekend effect</h4>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="gam.html#cb88-1"></a>tmp &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-2"><a href="gam.html#cb88-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data2 =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">filter</span>(., yweek <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">25</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-3"><a href="gam.html#cb88-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">map2</span>(data2, bm1, <span class="op">~</span><span class="kw">add_fitted_draws</span>(.x, .y))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-4"><a href="gam.html#cb88-4"></a><span class="st">  </span><span class="kw">select</span>(year, p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-5"><a href="gam.html#cb88-5"></a><span class="st">  </span><span class="kw">unnest</span>(p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-6"><a href="gam.html#cb88-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-7"><a href="gam.html#cb88-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yweek =</span> <span class="kw">fct_inorder</span>(<span class="kw">str_glue</span>(<span class="st">&quot;Week {yweek}&quot;</span>)))</span>
<span id="cb88-8"><a href="gam.html#cb88-8"></a>p1 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-9"><a href="gam.html#cb88-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(Date, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">week_start =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-10"><a href="gam.html#cb88-10"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek, wday, Players) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-11"><a href="gam.html#cb88-11"></a><span class="st">  </span><span class="kw">mean_qi</span>(.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-12"><a href="gam.html#cb88-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(wday, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb88-13"><a href="gam.html#cb88-13"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb88-14"><a href="gam.html#cb88-14"></a>    <span class="st">&quot;Players&quot;</span>,</span>
<span id="cb88-15"><a href="gam.html#cb88-15"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb88-16"><a href="gam.html#cb88-16"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb88-17"><a href="gam.html#cb88-17"></a>  ) <span class="op">+</span></span>
<span id="cb88-18"><a href="gam.html#cb88-18"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb88-19"><a href="gam.html#cb88-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Players), <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb88-20"><a href="gam.html#cb88-20"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb88-21"><a href="gam.html#cb88-21"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .value)) <span class="op">+</span></span>
<span id="cb88-22"><a href="gam.html#cb88-22"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>yweek)</span>
<span id="cb88-23"><a href="gam.html#cb88-23"></a>weffs_data &lt;-<span class="st"> </span>total <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-24"><a href="gam.html#cb88-24"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, wday, Players) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-25"><a href="gam.html#cb88-25"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> wday, <span class="dt">values_from =</span> Players) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-26"><a href="gam.html#cb88-26"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb88-27"><a href="gam.html#cb88-27"></a>    <span class="dt">Weekend_effect =</span> <span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">5</span><span class="st">`</span>, <span class="st">`</span><span class="dt">6</span><span class="st">`</span>)) <span class="op">/</span><span class="st"> </span></span>
<span id="cb88-28"><a href="gam.html#cb88-28"></a><span class="st">      </span><span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">0</span><span class="st">`</span>, <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="st">`</span><span class="dt">3</span><span class="st">`</span>, <span class="st">`</span><span class="dt">4</span><span class="st">`</span>)), </span>
<span id="cb88-29"><a href="gam.html#cb88-29"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-30"><a href="gam.html#cb88-30"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year))</span>
<span id="cb88-31"><a href="gam.html#cb88-31"></a>weffs &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-32"><a href="gam.html#cb88-32"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">map2</span>(data, bm1, <span class="op">~</span><span class="kw">add_fitted_draws</span>(.x, .y))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-33"><a href="gam.html#cb88-33"></a><span class="st">  </span><span class="kw">select</span>(year, p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-34"><a href="gam.html#cb88-34"></a><span class="st">  </span><span class="kw">unnest</span>(p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-35"><a href="gam.html#cb88-35"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, wday, .draw, .value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-36"><a href="gam.html#cb88-36"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> wday, <span class="dt">values_from =</span> <span class="kw">c</span>(.value)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-37"><a href="gam.html#cb88-37"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-38"><a href="gam.html#cb88-38"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb88-39"><a href="gam.html#cb88-39"></a>    <span class="dt">Weekend_effect =</span> <span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">5</span><span class="st">`</span>, <span class="st">`</span><span class="dt">6</span><span class="st">`</span>)) <span class="op">/</span><span class="st"> </span></span>
<span id="cb88-40"><a href="gam.html#cb88-40"></a><span class="st">      </span><span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">0</span><span class="st">`</span>, <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="st">`</span><span class="dt">3</span><span class="st">`</span>, <span class="st">`</span><span class="dt">4</span><span class="st">`</span>)), </span>
<span id="cb88-41"><a href="gam.html#cb88-41"></a>  )</span>
<span id="cb88-42"><a href="gam.html#cb88-42"></a></span>
<span id="cb88-43"><a href="gam.html#cb88-43"></a>p2 &lt;-<span class="st"> </span>weffs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-44"><a href="gam.html#cb88-44"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-45"><a href="gam.html#cb88-45"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-46"><a href="gam.html#cb88-46"></a><span class="st">  </span><span class="kw">mean_qi</span>(Weekend_effect) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-47"><a href="gam.html#cb88-47"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yweek, Weekend_effect, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb88-48"><a href="gam.html#cb88-48"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb88-49"><a href="gam.html#cb88-49"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb88-50"><a href="gam.html#cb88-50"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb88-51"><a href="gam.html#cb88-51"></a>    <span class="st">&quot;Weekend effect&quot;</span>,</span>
<span id="cb88-52"><a href="gam.html#cb88-52"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb88-53"><a href="gam.html#cb88-53"></a>    <span class="dt">labels =</span> scales<span class="op">::</span>percent</span>
<span id="cb88-54"><a href="gam.html#cb88-54"></a>  ) <span class="op">+</span></span>
<span id="cb88-55"><a href="gam.html#cb88-55"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb88-56"><a href="gam.html#cb88-56"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">.5</span>) <span class="op">+</span></span>
<span id="cb88-57"><a href="gam.html#cb88-57"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb88-58"><a href="gam.html#cb88-58"></a>    <span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.1</span></span>
<span id="cb88-59"><a href="gam.html#cb88-59"></a>  ) <span class="op">+</span></span>
<span id="cb88-60"><a href="gam.html#cb88-60"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> weffs_data, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb88-61"><a href="gam.html#cb88-61"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb88-62"><a href="gam.html#cb88-62"></a></span>
<span id="cb88-63"><a href="gam.html#cb88-63"></a><span class="co"># Excess weekend effect dataframe</span></span>
<span id="cb88-64"><a href="gam.html#cb88-64"></a>weffs2 &lt;-<span class="st"> </span>weffs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-65"><a href="gam.html#cb88-65"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, .draw, Weekend_effect) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-66"><a href="gam.html#cb88-66"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb88-67"><a href="gam.html#cb88-67"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(Weekend_effect)</span>
<span id="cb88-68"><a href="gam.html#cb88-68"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-69"><a href="gam.html#cb88-69"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Difference =</span> <span class="st">`</span><span class="dt">2020</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">2019</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-70"><a href="gam.html#cb88-70"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-71"><a href="gam.html#cb88-71"></a><span class="st">  </span><span class="kw">select</span>(year, yweek, .draw, Difference)</span>
<span id="cb88-72"><a href="gam.html#cb88-72"></a>p3 &lt;-<span class="st"> </span>weffs2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-73"><a href="gam.html#cb88-73"></a><span class="st">  </span><span class="kw">group_by</span>(year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-74"><a href="gam.html#cb88-74"></a><span class="st">  </span><span class="kw">mean_qi</span>(Difference) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-75"><a href="gam.html#cb88-75"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yweek, Difference)) <span class="op">+</span></span>
<span id="cb88-76"><a href="gam.html#cb88-76"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb88-77"><a href="gam.html#cb88-77"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb88-78"><a href="gam.html#cb88-78"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb88-79"><a href="gam.html#cb88-79"></a>    <span class="st">&quot;Difference</span><span class="ch">\n</span><span class="st">(2020 - 2019)&quot;</span>,</span>
<span id="cb88-80"><a href="gam.html#cb88-80"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb88-81"><a href="gam.html#cb88-81"></a>  ) <span class="op">+</span></span>
<span id="cb88-82"><a href="gam.html#cb88-82"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb88-83"><a href="gam.html#cb88-83"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb88-84"><a href="gam.html#cb88-84"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb88-85"><a href="gam.html#cb88-85"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb88-86"><a href="gam.html#cb88-86"></a>((p1 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())) <span class="op">/</span><span class="st"> </span>p2) <span class="op">+</span><span class="st"> </span></span>
<span id="cb88-87"><a href="gam.html#cb88-87"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">4</span>, <span class="fl">.6</span>), <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="gam.html#cb89-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;Figure2-brms.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="multiplayer" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Multiplayer</h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="gam.html#cb90-1"></a>mp &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-2"><a href="gam.html#cb90-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-3"><a href="gam.html#cb90-3"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="kw">across</span>(<span class="kw">c</span>(MP, Date, year<span class="op">:</span>wend))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-4"><a href="gam.html#cb90-4"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb90-5"><a href="gam.html#cb90-5"></a>    <span class="dt">Players =</span> <span class="kw">sum</span>(Players, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </span>
<span id="cb90-6"><a href="gam.html#cb90-6"></a>    <span class="dt">ngames =</span> <span class="kw">length</span>(<span class="kw">unique</span>(appid))</span>
<span id="cb90-7"><a href="gam.html#cb90-7"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-8"><a href="gam.html#cb90-8"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-9"><a href="gam.html#cb90-9"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-10"><a href="gam.html#cb90-10"></a><span class="st">  </span><span class="kw">nest</span>()</span>
<span id="cb90-11"><a href="gam.html#cb90-11"></a>mp</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
## # Groups:   MP, year [4]
##   MP    year  data              
##   &lt;fct&gt; &lt;fct&gt; &lt;list&gt;            
## 1 No    2019  &lt;tibble [196 × 8]&gt;
## 2 No    2020  &lt;tibble [196 × 8]&gt;
## 3 Yes   2019  &lt;tibble [196 × 8]&gt;
## 4 Yes   2020  &lt;tibble [196 × 8]&gt;</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="gam.html#cb92-1"></a>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-2"><a href="gam.html#cb92-2"></a><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-3"><a href="gam.html#cb92-3"></a><span class="st">  </span><span class="co"># Make dates same across years for viz</span></span>
<span id="cb92-4"><a href="gam.html#cb92-4"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-5"><a href="gam.html#cb92-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-6"><a href="gam.html#cb92-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-7"><a href="gam.html#cb92-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Date, Players, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb92-8"><a href="gam.html#cb92-8"></a><span class="st">  </span><span class="co"># scale_x_date() +</span></span>
<span id="cb92-9"><a href="gam.html#cb92-9"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> cd, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb92-10"><a href="gam.html#cb92-10"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb92-11"><a href="gam.html#cb92-11"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) <span class="op">+</span></span>
<span id="cb92-12"><a href="gam.html#cb92-12"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb92-13"><a href="gam.html#cb92-13"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb92-14"><a href="gam.html#cb92-14"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb92-15"><a href="gam.html#cb92-15"></a>  ) <span class="op">+</span></span>
<span id="cb92-16"><a href="gam.html#cb92-16"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">.3</span>) <span class="op">+</span></span>
<span id="cb92-17"><a href="gam.html#cb92-17"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb92-18"><a href="gam.html#cb92-18"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">rows =</span> <span class="st">&quot;MP&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div id="mgcv-1" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> mgcv</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="gam.html#cb93-1"></a>mp &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-2"><a href="gam.html#cb93-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb93-3"><a href="gam.html#cb93-3"></a>    <span class="dt">m0 =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">gamm</span>(</span>
<span id="cb93-4"><a href="gam.html#cb93-4"></a>      Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, <span class="dt">k =</span> <span class="dv">27</span>) <span class="op">+</span><span class="st"> </span><span class="kw">t2</span>(wday, <span class="dt">k =</span> <span class="dv">7</span>),</span>
<span id="cb93-5"><a href="gam.html#cb93-5"></a>      <span class="dt">data =</span> .x,</span>
<span id="cb93-6"><a href="gam.html#cb93-6"></a>      <span class="dt">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb93-7"><a href="gam.html#cb93-7"></a>    )),</span>
<span id="cb93-8"><a href="gam.html#cb93-8"></a>    <span class="dt">m1 =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">gamm</span>(</span>
<span id="cb93-9"><a href="gam.html#cb93-9"></a>      Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, wday, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">7</span>)),</span>
<span id="cb93-10"><a href="gam.html#cb93-10"></a>      <span class="dt">data =</span> .x,</span>
<span id="cb93-11"><a href="gam.html#cb93-11"></a>      <span class="dt">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb93-12"><a href="gam.html#cb93-12"></a>    ))</span>
<span id="cb93-13"><a href="gam.html#cb93-13"></a>  )</span></code></pre></div>
<p>Figure</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="gam.html#cb94-1"></a><span class="co"># Prediction dataframe</span></span>
<span id="cb94-2"><a href="gam.html#cb94-2"></a>tmp &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-3"><a href="gam.html#cb94-3"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-4"><a href="gam.html#cb94-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MP =</span> <span class="kw">factor</span>(MP, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Single-player&quot;</span>, <span class="st">&quot;Multiplayer&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-5"><a href="gam.html#cb94-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb94-6"><a href="gam.html#cb94-6"></a>    <span class="dt">preds =</span> <span class="kw">map</span>(m1, <span class="op">~</span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(.x[[<span class="st">&quot;gam&quot;</span>]], <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)))</span>
<span id="cb94-7"><a href="gam.html#cb94-7"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-8"><a href="gam.html#cb94-8"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(data, preds)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-9"><a href="gam.html#cb94-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-10"><a href="gam.html#cb94-10"></a><span class="st">  </span><span class="co"># Make dates same for 2019 and 2020 to put on same plot</span></span>
<span id="cb94-11"><a href="gam.html#cb94-11"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-12"><a href="gam.html#cb94-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-13"><a href="gam.html#cb94-13"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb94-14"><a href="gam.html#cb94-14"></a><span class="co"># Excess players dataframe</span></span>
<span id="cb94-15"><a href="gam.html#cb94-15"></a>tmp2 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-16"><a href="gam.html#cb94-16"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, Players, fit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-17"><a href="gam.html#cb94-17"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb94-18"><a href="gam.html#cb94-18"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(Players, fit), <span class="dt">values_fn =</span> mean</span>
<span id="cb94-19"><a href="gam.html#cb94-19"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-20"><a href="gam.html#cb94-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_empirical =</span> Players_<span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>Players_<span class="dv">2019</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-21"><a href="gam.html#cb94-21"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_model =</span> fit_<span class="dv">2020</span> <span class="op">-</span><span class="st"> </span>fit_<span class="dv">2019</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-22"><a href="gam.html#cb94-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-23"><a href="gam.html#cb94-23"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, <span class="kw">starts_with</span>(<span class="st">&quot;excess&quot;</span>))</span>
<span id="cb94-24"><a href="gam.html#cb94-24"></a><span class="co"># Predictions and data figure</span></span>
<span id="cb94-25"><a href="gam.html#cb94-25"></a>p1 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span></span>
<span id="cb94-26"><a href="gam.html#cb94-26"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Date, Players, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb94-27"><a href="gam.html#cb94-27"></a><span class="st">  </span><span class="co"># scale_x_date() +</span></span>
<span id="cb94-28"><a href="gam.html#cb94-28"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> cd, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb94-29"><a href="gam.html#cb94-29"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb94-30"><a href="gam.html#cb94-30"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) <span class="op">+</span></span>
<span id="cb94-31"><a href="gam.html#cb94-31"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb94-32"><a href="gam.html#cb94-32"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb94-33"><a href="gam.html#cb94-33"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb94-34"><a href="gam.html#cb94-34"></a>  ) <span class="op">+</span></span>
<span id="cb94-35"><a href="gam.html#cb94-35"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb94-36"><a href="gam.html#cb94-36"></a>    <span class="kw">aes</span>(<span class="dt">ymin =</span> fit<span class="op">-</span>se.fit<span class="op">*</span><span class="dv">2</span>, <span class="dt">ymax =</span> fit<span class="op">+</span>se.fit<span class="op">*</span><span class="dv">2</span>), <span class="dt">alpha=</span>.<span class="dv">1</span></span>
<span id="cb94-37"><a href="gam.html#cb94-37"></a>  ) <span class="op">+</span></span>
<span id="cb94-38"><a href="gam.html#cb94-38"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>fit), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb94-39"><a href="gam.html#cb94-39"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb94-40"><a href="gam.html#cb94-40"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;MP&quot;</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb94-41"><a href="gam.html#cb94-41"></a>p1</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="gam.html#cb95-1"></a><span class="co"># Excess gaming figure  </span></span>
<span id="cb95-2"><a href="gam.html#cb95-2"></a>p2 &lt;-<span class="st"> </span>tmp2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-3"><a href="gam.html#cb95-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yweek, <span class="dt">alpha =</span> <span class="ot">NA</span>)) <span class="op">+</span></span>
<span id="cb95-4"><a href="gam.html#cb95-4"></a><span class="st">  </span><span class="co"># Week of WHO announcement</span></span>
<span id="cb95-5"><a href="gam.html#cb95-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb95-6"><a href="gam.html#cb95-6"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb95-7"><a href="gam.html#cb95-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> excess_model), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb95-8"><a href="gam.html#cb95-8"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb95-9"><a href="gam.html#cb95-9"></a>    <span class="kw">aes</span>(<span class="dt">y =</span> excess_empirical), </span>
<span id="cb95-10"><a href="gam.html#cb95-10"></a>    <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb95-11"><a href="gam.html#cb95-11"></a>  ) <span class="op">+</span></span>
<span id="cb95-12"><a href="gam.html#cb95-12"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb95-13"><a href="gam.html#cb95-13"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb95-14"><a href="gam.html#cb95-14"></a>    <span class="st">&quot;Excess players</span><span class="ch">\n</span><span class="st">(2020 - 2019)&quot;</span>,</span>
<span id="cb95-15"><a href="gam.html#cb95-15"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb95-16"><a href="gam.html#cb95-16"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb95-17"><a href="gam.html#cb95-17"></a>  ) <span class="op">+</span></span>
<span id="cb95-18"><a href="gam.html#cb95-18"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;MP&quot;</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb95-19"><a href="gam.html#cb95-19"></a>p2</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="gam.html#cb97-1"></a>(p1 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())) <span class="op">/</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></span>
<span id="cb97-2"><a href="gam.html#cb97-2"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">75</span>, <span class="fl">.25</span>), <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-12-3.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="gam.html#cb99-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;Figure1-mp-mgcv.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p>Weekend effect figure</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="gam.html#cb101-1"></a>mp <span class="op">%&gt;%</span></span>
<span id="cb101-2"><a href="gam.html#cb101-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">preds =</span> <span class="kw">map</span>(m1, <span class="op">~</span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(.x[[<span class="st">&quot;gam&quot;</span>]], <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb101-3"><a href="gam.html#cb101-3"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(data, preds)) <span class="op">%&gt;%</span></span>
<span id="cb101-4"><a href="gam.html#cb101-4"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek) <span class="op">%&gt;%</span></span>
<span id="cb101-5"><a href="gam.html#cb101-5"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb101-6"><a href="gam.html#cb101-6"></a>    <span class="dt">w_eff =</span> <span class="kw">mean</span>(Players[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">6</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Players[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">4</span>]),</span>
<span id="cb101-7"><a href="gam.html#cb101-7"></a>    <span class="dt">fit =</span> <span class="kw">mean</span>(fit[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">6</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(fit[wday <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">4</span>]),</span>
<span id="cb101-8"><a href="gam.html#cb101-8"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb101-9"><a href="gam.html#cb101-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-10"><a href="gam.html#cb101-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yweek, w_eff, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb101-11"><a href="gam.html#cb101-11"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(</span>
<span id="cb101-12"><a href="gam.html#cb101-12"></a>    <span class="st">&quot;Week number&quot;</span>,</span>
<span id="cb101-13"><a href="gam.html#cb101-13"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()</span>
<span id="cb101-14"><a href="gam.html#cb101-14"></a>  ) <span class="op">+</span></span>
<span id="cb101-15"><a href="gam.html#cb101-15"></a><span class="st">    </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb101-16"><a href="gam.html#cb101-16"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb101-17"><a href="gam.html#cb101-17"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb101-18"><a href="gam.html#cb101-18"></a>  ) <span class="op">+</span></span>
<span id="cb101-19"><a href="gam.html#cb101-19"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb101-20"><a href="gam.html#cb101-20"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>fit)) <span class="op">+</span></span>
<span id="cb101-21"><a href="gam.html#cb101-21"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb101-22"><a href="gam.html#cb101-22"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;MP&quot;</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="brms-1" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> brms</h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="gam.html#cb102-1"></a>sampler_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">brm</span>(</span>
<span id="cb102-2"><a href="gam.html#cb102-2"></a>  Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, <span class="dt">k =</span> <span class="dv">27</span>) <span class="op">+</span><span class="st"> </span><span class="kw">t2</span>(wday, <span class="dt">k =</span> <span class="dv">7</span>),</span>
<span id="cb102-3"><a href="gam.html#cb102-3"></a>  <span class="dt">data =</span> mp<span class="op">$</span>data[[<span class="dv">1</span>]],</span>
<span id="cb102-4"><a href="gam.html#cb102-4"></a>  <span class="dt">chains =</span> <span class="dv">0</span>,</span>
<span id="cb102-5"><a href="gam.html#cb102-5"></a>  <span class="dt">file =</span> <span class="st">&quot;models/brm-sampler-mp-0&quot;</span></span>
<span id="cb102-6"><a href="gam.html#cb102-6"></a>)</span>
<span id="cb102-7"><a href="gam.html#cb102-7"></a>sampler_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">brm</span>(</span>
<span id="cb102-8"><a href="gam.html#cb102-8"></a>  Players <span class="op">~</span><span class="st"> </span><span class="kw">t2</span>(yday, wday, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">7</span>)),</span>
<span id="cb102-9"><a href="gam.html#cb102-9"></a>  <span class="dt">data =</span> mp<span class="op">$</span>data[[<span class="dv">1</span>]],</span>
<span id="cb102-10"><a href="gam.html#cb102-10"></a>  <span class="dt">chains =</span> <span class="dv">0</span>,</span>
<span id="cb102-11"><a href="gam.html#cb102-11"></a>  <span class="dt">file =</span> <span class="st">&quot;models/brm-sampler-mp-1&quot;</span></span>
<span id="cb102-12"><a href="gam.html#cb102-12"></a>)</span>
<span id="cb102-13"><a href="gam.html#cb102-13"></a><span class="co"># This model has a hard time converging so we set inits for the intercept</span></span>
<span id="cb102-14"><a href="gam.html#cb102-14"></a>mp<span class="op">$</span>bm0 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">4</span>)</span>
<span id="cb102-15"><a href="gam.html#cb102-15"></a>mp<span class="op">$</span>bm1 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">4</span>)</span>
<span id="cb102-16"><a href="gam.html#cb102-16"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</span>
<span id="cb102-17"><a href="gam.html#cb102-17"></a>  this_data &lt;-<span class="st"> </span>mp<span class="op">$</span>data[[i]]</span>
<span id="cb102-18"><a href="gam.html#cb102-18"></a>    mp<span class="op">$</span>bm0[[i]] &lt;-<span class="st"> </span><span class="kw">update</span>(</span>
<span id="cb102-19"><a href="gam.html#cb102-19"></a>    sampler_<span class="dv">0</span>,</span>
<span id="cb102-20"><a href="gam.html#cb102-20"></a>    <span class="dt">newdata =</span> this_data,</span>
<span id="cb102-21"><a href="gam.html#cb102-21"></a>    <span class="dt">chains =</span> <span class="dv">4</span>,</span>
<span id="cb102-22"><a href="gam.html#cb102-22"></a>    <span class="dt">iter =</span> <span class="dv">3000</span>,</span>
<span id="cb102-23"><a href="gam.html#cb102-23"></a>    <span class="dt">inits =</span> <span class="cf">function</span>() {<span class="kw">list</span>(<span class="dt">Intercept =</span> <span class="kw">mean</span>(this_data<span class="op">$</span>Players))},</span>
<span id="cb102-24"><a href="gam.html#cb102-24"></a>    <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</span>
<span id="cb102-25"><a href="gam.html#cb102-25"></a>    <span class="dt">file =</span> <span class="kw">str_glue</span>(<span class="st">&quot;models/brm-mp-{i}-m0&quot;</span>)</span>
<span id="cb102-26"><a href="gam.html#cb102-26"></a>    )</span>
<span id="cb102-27"><a href="gam.html#cb102-27"></a>  mp<span class="op">$</span>bm1[[i]] &lt;-<span class="st"> </span><span class="kw">update</span>(</span>
<span id="cb102-28"><a href="gam.html#cb102-28"></a>    sampler_<span class="dv">1</span>,</span>
<span id="cb102-29"><a href="gam.html#cb102-29"></a>    <span class="dt">newdata =</span> this_data,</span>
<span id="cb102-30"><a href="gam.html#cb102-30"></a>    <span class="dt">chains =</span> <span class="dv">4</span>,</span>
<span id="cb102-31"><a href="gam.html#cb102-31"></a>    <span class="dt">iter =</span> <span class="dv">3000</span>,</span>
<span id="cb102-32"><a href="gam.html#cb102-32"></a>    <span class="dt">inits =</span> <span class="cf">function</span>() {<span class="kw">list</span>(<span class="dt">Intercept =</span> <span class="kw">mean</span>(this_data<span class="op">$</span>Players))},</span>
<span id="cb102-33"><a href="gam.html#cb102-33"></a>    <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</span>
<span id="cb102-34"><a href="gam.html#cb102-34"></a>    <span class="dt">file =</span> <span class="kw">str_glue</span>(<span class="st">&quot;models/brm-mp-{i}-m1&quot;</span>)</span>
<span id="cb102-35"><a href="gam.html#cb102-35"></a>    )</span>
<span id="cb102-36"><a href="gam.html#cb102-36"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="gam.html#cb103-1"></a><span class="co"># Did the inits work?</span></span>
<span id="cb103-2"><a href="gam.html#cb103-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</span>
<span id="cb103-3"><a href="gam.html#cb103-3"></a>  <span class="kw">print</span>(<span class="kw">mean</span>(mp<span class="op">$</span>data[[i]][[<span class="st">&quot;Players&quot;</span>]]))</span>
<span id="cb103-4"><a href="gam.html#cb103-4"></a>  <span class="kw">print</span>(mp<span class="op">$</span>bm1[[i]][[<span class="st">&quot;fit&quot;</span>]]<span class="op">@</span>inits[[<span class="dv">1</span>]][[<span class="st">&quot;Intercept&quot;</span>]])</span>
<span id="cb103-5"><a href="gam.html#cb103-5"></a>}</span></code></pre></div>
<pre><code>## [1] 314174.4
## [1] 314174.4
## [1] 370239.5
## [1] 370239.5
## [1] 3810860
## [1] 3810860
## [1] 4121149
## [1] 4121149</code></pre>
<div id="figure-1" class="section level4" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Figure</h4>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="gam.html#cb105-1"></a><span class="co"># Prediction dataframe</span></span>
<span id="cb105-2"><a href="gam.html#cb105-2"></a>mp &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-3"><a href="gam.html#cb105-3"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-4"><a href="gam.html#cb105-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MP =</span> <span class="kw">factor</span>(MP, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Single-player&quot;</span>, <span class="st">&quot;Multiplayer&quot;</span>)))</span>
<span id="cb105-5"><a href="gam.html#cb105-5"></a>tmp &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-6"><a href="gam.html#cb105-6"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb105-7"><a href="gam.html#cb105-7"></a>    <span class="dt">p =</span> <span class="kw">map2</span>(data, bm1, <span class="op">~</span><span class="kw">add_fitted_draws</span>(.x, .y))</span>
<span id="cb105-8"><a href="gam.html#cb105-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-9"><a href="gam.html#cb105-9"></a><span class="st">  </span><span class="kw">select</span>(MP, year, p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-10"><a href="gam.html#cb105-10"></a><span class="st">  </span><span class="kw">unnest</span>(p)</span>
<span id="cb105-11"><a href="gam.html#cb105-11"></a></span>
<span id="cb105-12"><a href="gam.html#cb105-12"></a><span class="co"># Data with same dates for years for visualizing</span></span>
<span id="cb105-13"><a href="gam.html#cb105-13"></a>xtmp &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-14"><a href="gam.html#cb105-14"></a><span class="st">  </span><span class="kw">select</span>(MP, year, data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-15"><a href="gam.html#cb105-15"></a><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-16"><a href="gam.html#cb105-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-17"><a href="gam.html#cb105-17"></a><span class="st">  </span><span class="co"># Make dates same for 2019 and 2020 to put on same plot</span></span>
<span id="cb105-18"><a href="gam.html#cb105-18"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-19"><a href="gam.html#cb105-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-20"><a href="gam.html#cb105-20"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb105-21"><a href="gam.html#cb105-21"></a></span>
<span id="cb105-22"><a href="gam.html#cb105-22"></a><span class="co"># Predictions and data figure</span></span>
<span id="cb105-23"><a href="gam.html#cb105-23"></a>p1 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span></span>
<span id="cb105-24"><a href="gam.html#cb105-24"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-25"><a href="gam.html#cb105-25"></a><span class="st">  </span><span class="co"># Make dates same for 2019 and 2020 to put on same plot</span></span>
<span id="cb105-26"><a href="gam.html#cb105-26"></a><span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-27"><a href="gam.html#cb105-27"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">last</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-28"><a href="gam.html#cb105-28"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-29"><a href="gam.html#cb105-29"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, Date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-30"><a href="gam.html#cb105-30"></a><span class="st">  </span><span class="kw">mean_qi</span>(.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-31"><a href="gam.html#cb105-31"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-32"><a href="gam.html#cb105-32"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Date, .value, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb105-33"><a href="gam.html#cb105-33"></a><span class="st">  </span><span class="co"># scale_x_date() +</span></span>
<span id="cb105-34"><a href="gam.html#cb105-34"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> cd, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb105-35"><a href="gam.html#cb105-35"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb105-36"><a href="gam.html#cb105-36"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) <span class="op">+</span></span>
<span id="cb105-37"><a href="gam.html#cb105-37"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb105-38"><a href="gam.html#cb105-38"></a>    <span class="st">&quot;Players&quot;</span>,</span>
<span id="cb105-39"><a href="gam.html#cb105-39"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb105-40"><a href="gam.html#cb105-40"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb105-41"><a href="gam.html#cb105-41"></a>  ) <span class="op">+</span></span>
<span id="cb105-42"><a href="gam.html#cb105-42"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb105-43"><a href="gam.html#cb105-43"></a>    <span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha=</span>.<span class="dv">1</span></span>
<span id="cb105-44"><a href="gam.html#cb105-44"></a>  ) <span class="op">+</span></span>
<span id="cb105-45"><a href="gam.html#cb105-45"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb105-46"><a href="gam.html#cb105-46"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb105-47"><a href="gam.html#cb105-47"></a>    <span class="dt">data =</span> xtmp, </span>
<span id="cb105-48"><a href="gam.html#cb105-48"></a>    <span class="kw">aes</span>(<span class="dt">y=</span>Players), <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb105-49"><a href="gam.html#cb105-49"></a>  ) <span class="op">+</span></span>
<span id="cb105-50"><a href="gam.html#cb105-50"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;MP&quot;</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb105-51"><a href="gam.html#cb105-51"></a></span>
<span id="cb105-52"><a href="gam.html#cb105-52"></a><span class="co"># Excess players dataframe</span></span>
<span id="cb105-53"><a href="gam.html#cb105-53"></a>tmp2 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-54"><a href="gam.html#cb105-54"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek, .draw) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-55"><a href="gam.html#cb105-55"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">week_mean =</span> <span class="kw">mean</span>(.value)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-56"><a href="gam.html#cb105-56"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">.draw =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-57"><a href="gam.html#cb105-57"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-58"><a href="gam.html#cb105-58"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb105-59"><a href="gam.html#cb105-59"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(week_mean)</span>
<span id="cb105-60"><a href="gam.html#cb105-60"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-61"><a href="gam.html#cb105-61"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_model =</span> <span class="st">`</span><span class="dt">2020</span><span class="st">`</span> <span class="op">/</span><span class="st"> `</span><span class="dt">2019</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-62"><a href="gam.html#cb105-62"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-63"><a href="gam.html#cb105-63"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, <span class="kw">starts_with</span>(<span class="st">&quot;excess&quot;</span>))</span>
<span id="cb105-64"><a href="gam.html#cb105-64"></a>tmp3 &lt;-<span class="st"> </span>xtmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-65"><a href="gam.html#cb105-65"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-66"><a href="gam.html#cb105-66"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">week_mean =</span> <span class="kw">mean</span>(Players)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-67"><a href="gam.html#cb105-67"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb105-68"><a href="gam.html#cb105-68"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(week_mean)</span>
<span id="cb105-69"><a href="gam.html#cb105-69"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-70"><a href="gam.html#cb105-70"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">excess_data =</span> <span class="st">`</span><span class="dt">2020</span><span class="st">`</span> <span class="op">/</span><span class="st"> `</span><span class="dt">2019</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-71"><a href="gam.html#cb105-71"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-72"><a href="gam.html#cb105-72"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, <span class="kw">starts_with</span>(<span class="st">&quot;excess&quot;</span>))</span>
<span id="cb105-73"><a href="gam.html#cb105-73"></a>  <span class="co"># left_join(select(tmp, year, Date, yweek))</span></span>
<span id="cb105-74"><a href="gam.html#cb105-74"></a><span class="co"># Excess gaming figure  </span></span>
<span id="cb105-75"><a href="gam.html#cb105-75"></a>p2 &lt;-<span class="st"> </span>tmp2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-76"><a href="gam.html#cb105-76"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-77"><a href="gam.html#cb105-77"></a><span class="st">  </span><span class="kw">mean_qi</span>(excess_model) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-78"><a href="gam.html#cb105-78"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yweek, <span class="dt">alpha =</span> <span class="ot">NA</span>)) <span class="op">+</span></span>
<span id="cb105-79"><a href="gam.html#cb105-79"></a><span class="st">  </span><span class="co"># Week of WHO announcement</span></span>
<span id="cb105-80"><a href="gam.html#cb105-80"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb105-81"><a href="gam.html#cb105-81"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb105-82"><a href="gam.html#cb105-82"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb105-83"><a href="gam.html#cb105-83"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> excess_model), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb105-84"><a href="gam.html#cb105-84"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb105-85"><a href="gam.html#cb105-85"></a>    <span class="dt">data =</span> tmp3,</span>
<span id="cb105-86"><a href="gam.html#cb105-86"></a>    <span class="kw">aes</span>(<span class="dt">y =</span> excess_data),</span>
<span id="cb105-87"><a href="gam.html#cb105-87"></a>    <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb105-88"><a href="gam.html#cb105-88"></a>  ) <span class="op">+</span></span>
<span id="cb105-89"><a href="gam.html#cb105-89"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb105-90"><a href="gam.html#cb105-90"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb105-91"><a href="gam.html#cb105-91"></a>    <span class="st">&quot;2020 excess&quot;</span>,</span>
<span id="cb105-92"><a href="gam.html#cb105-92"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb105-93"><a href="gam.html#cb105-93"></a>    <span class="dt">labels =</span> scales<span class="op">::</span>percent</span>
<span id="cb105-94"><a href="gam.html#cb105-94"></a>  ) <span class="op">+</span></span>
<span id="cb105-95"><a href="gam.html#cb105-95"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;MP&quot;</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb105-96"><a href="gam.html#cb105-96"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>())</span>
<span id="cb105-97"><a href="gam.html#cb105-97"></a></span>
<span id="cb105-98"><a href="gam.html#cb105-98"></a>(p1 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())) <span class="op">/</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></span>
<span id="cb105-99"><a href="gam.html#cb105-99"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">75</span>, <span class="fl">.25</span>), <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb105-100"><a href="gam.html#cb105-100"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="gam.html#cb107-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;Figure1-mp-brms.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div id="weekend-effect-1" class="section level4" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Weekend effect</h4>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="gam.html#cb109-1"></a>tmp &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-2"><a href="gam.html#cb109-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data2 =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">filter</span>(., yweek <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">25</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-3"><a href="gam.html#cb109-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">map2</span>(data2, bm1, <span class="op">~</span><span class="kw">add_fitted_draws</span>(.x, .y))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-4"><a href="gam.html#cb109-4"></a><span class="st">  </span><span class="kw">select</span>(MP, year, p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-5"><a href="gam.html#cb109-5"></a><span class="st">  </span><span class="kw">unnest</span>(p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-6"><a href="gam.html#cb109-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-7"><a href="gam.html#cb109-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yweek =</span> <span class="kw">fct_inorder</span>(<span class="kw">str_glue</span>(<span class="st">&quot;Week {yweek}&quot;</span>)))</span>
<span id="cb109-8"><a href="gam.html#cb109-8"></a>p1 &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-9"><a href="gam.html#cb109-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(Date, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">week_start =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-10"><a href="gam.html#cb109-10"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek, wday, Players) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-11"><a href="gam.html#cb109-11"></a><span class="st">  </span><span class="kw">mean_qi</span>(.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-12"><a href="gam.html#cb109-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(wday, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb109-13"><a href="gam.html#cb109-13"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb109-14"><a href="gam.html#cb109-14"></a>    <span class="st">&quot;Players&quot;</span>,</span>
<span id="cb109-15"><a href="gam.html#cb109-15"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), </span>
<span id="cb109-16"><a href="gam.html#cb109-16"></a>    <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb109-17"><a href="gam.html#cb109-17"></a>  ) <span class="op">+</span></span>
<span id="cb109-18"><a href="gam.html#cb109-18"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb109-19"><a href="gam.html#cb109-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Players), <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb109-20"><a href="gam.html#cb109-20"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb109-21"><a href="gam.html#cb109-21"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .value)) <span class="op">+</span></span>
<span id="cb109-22"><a href="gam.html#cb109-22"></a><span class="st">  </span><span class="kw">facet_grid</span>(MP<span class="op">~</span>yweek, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb109-23"><a href="gam.html#cb109-23"></a>p1</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="gam.html#cb110-1"></a>weffs_data &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-2"><a href="gam.html#cb110-2"></a><span class="st">  </span><span class="kw">select</span>(MP, year, data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-3"><a href="gam.html#cb110-3"></a><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-4"><a href="gam.html#cb110-4"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, wday, Players) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-5"><a href="gam.html#cb110-5"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> wday, <span class="dt">values_from =</span> Players) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-6"><a href="gam.html#cb110-6"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb110-7"><a href="gam.html#cb110-7"></a>    <span class="dt">Weekend_effect =</span> <span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">5</span><span class="st">`</span>, <span class="st">`</span><span class="dt">6</span><span class="st">`</span>)) <span class="op">/</span><span class="st"> </span></span>
<span id="cb110-8"><a href="gam.html#cb110-8"></a><span class="st">      </span><span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">0</span><span class="st">`</span>, <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="st">`</span><span class="dt">3</span><span class="st">`</span>, <span class="st">`</span><span class="dt">4</span><span class="st">`</span>)), </span>
<span id="cb110-9"><a href="gam.html#cb110-9"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-10"><a href="gam.html#cb110-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year))</span>
<span id="cb110-11"><a href="gam.html#cb110-11"></a>weffs &lt;-<span class="st"> </span>mp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-12"><a href="gam.html#cb110-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">map2</span>(data, bm1, <span class="op">~</span><span class="kw">add_fitted_draws</span>(.x, .y))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-13"><a href="gam.html#cb110-13"></a><span class="st">  </span><span class="kw">select</span>(MP, year, p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-14"><a href="gam.html#cb110-14"></a><span class="st">  </span><span class="kw">unnest</span>(p) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-15"><a href="gam.html#cb110-15"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, wday, .draw, .value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-16"><a href="gam.html#cb110-16"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> wday, <span class="dt">values_from =</span> <span class="kw">c</span>(.value)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-17"><a href="gam.html#cb110-17"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-18"><a href="gam.html#cb110-18"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb110-19"><a href="gam.html#cb110-19"></a>    <span class="dt">Weekend_effect =</span> <span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">5</span><span class="st">`</span>, <span class="st">`</span><span class="dt">6</span><span class="st">`</span>)) <span class="op">/</span><span class="st"> </span></span>
<span id="cb110-20"><a href="gam.html#cb110-20"></a><span class="st">      </span><span class="kw">rowMeans</span>(<span class="kw">select</span>(., <span class="st">`</span><span class="dt">0</span><span class="st">`</span>, <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="st">`</span><span class="dt">3</span><span class="st">`</span>, <span class="st">`</span><span class="dt">4</span><span class="st">`</span>)), </span>
<span id="cb110-21"><a href="gam.html#cb110-21"></a>  )</span>
<span id="cb110-22"><a href="gam.html#cb110-22"></a></span>
<span id="cb110-23"><a href="gam.html#cb110-23"></a>p2 &lt;-<span class="st"> </span>weffs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-24"><a href="gam.html#cb110-24"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-25"><a href="gam.html#cb110-25"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-26"><a href="gam.html#cb110-26"></a><span class="st">  </span><span class="kw">mean_qi</span>(Weekend_effect) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-27"><a href="gam.html#cb110-27"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yweek, Weekend_effect, <span class="dt">alpha =</span> year, <span class="dt">group =</span> year)) <span class="op">+</span></span>
<span id="cb110-28"><a href="gam.html#cb110-28"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb110-29"><a href="gam.html#cb110-29"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb110-30"><a href="gam.html#cb110-30"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb110-31"><a href="gam.html#cb110-31"></a>    <span class="st">&quot;Weekend effect&quot;</span>,</span>
<span id="cb110-32"><a href="gam.html#cb110-32"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), <span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb110-33"><a href="gam.html#cb110-33"></a>  ) <span class="op">+</span></span>
<span id="cb110-34"><a href="gam.html#cb110-34"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="st">&quot;Year&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb110-35"><a href="gam.html#cb110-35"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">.5</span>) <span class="op">+</span></span>
<span id="cb110-36"><a href="gam.html#cb110-36"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb110-37"><a href="gam.html#cb110-37"></a>    <span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.1</span></span>
<span id="cb110-38"><a href="gam.html#cb110-38"></a>  ) <span class="op">+</span></span>
<span id="cb110-39"><a href="gam.html#cb110-39"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> weffs_data, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb110-40"><a href="gam.html#cb110-40"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb110-41"><a href="gam.html#cb110-41"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">rows =</span> <span class="st">&quot;MP&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb110-42"><a href="gam.html#cb110-42"></a></span>
<span id="cb110-43"><a href="gam.html#cb110-43"></a><span class="co"># Excess weekend effect dataframe</span></span>
<span id="cb110-44"><a href="gam.html#cb110-44"></a>weffs2 &lt;-<span class="st"> </span>weffs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-45"><a href="gam.html#cb110-45"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, .draw, Weekend_effect) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-46"><a href="gam.html#cb110-46"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb110-47"><a href="gam.html#cb110-47"></a>    <span class="dt">names_from =</span> year, <span class="dt">values_from =</span> <span class="kw">c</span>(Weekend_effect)</span>
<span id="cb110-48"><a href="gam.html#cb110-48"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-49"><a href="gam.html#cb110-49"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Difference =</span> <span class="st">`</span><span class="dt">2020</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">2019</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-50"><a href="gam.html#cb110-50"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="st">&quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-51"><a href="gam.html#cb110-51"></a><span class="st">  </span><span class="kw">select</span>(MP, year, yweek, .draw, Difference)</span>
<span id="cb110-52"><a href="gam.html#cb110-52"></a>p3 &lt;-<span class="st"> </span>weffs2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-53"><a href="gam.html#cb110-53"></a><span class="st">  </span><span class="kw">group_by</span>(MP, year, yweek) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-54"><a href="gam.html#cb110-54"></a><span class="st">  </span><span class="kw">mean_qi</span>(Difference) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-55"><a href="gam.html#cb110-55"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yweek, Difference)) <span class="op">+</span></span>
<span id="cb110-56"><a href="gam.html#cb110-56"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">floor</span>(<span class="kw">yday</span>(cd) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>), <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb110-57"><a href="gam.html#cb110-57"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Week of year&quot;</span>, <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()) <span class="op">+</span></span>
<span id="cb110-58"><a href="gam.html#cb110-58"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb110-59"><a href="gam.html#cb110-59"></a>    <span class="st">&quot;Difference</span><span class="ch">\n</span><span class="st">(2020 - 2019)&quot;</span>,</span>
<span id="cb110-60"><a href="gam.html#cb110-60"></a>    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>(), <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">str_glue</span>(<span class="st">&quot;{x/1e6}M&quot;</span>)</span>
<span id="cb110-61"><a href="gam.html#cb110-61"></a>  ) <span class="op">+</span></span>
<span id="cb110-62"><a href="gam.html#cb110-62"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb110-63"><a href="gam.html#cb110-63"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper), <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></span>
<span id="cb110-64"><a href="gam.html#cb110-64"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb110-65"><a href="gam.html#cb110-65"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;MP&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb110-66"><a href="gam.html#cb110-66"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb110-67"><a href="gam.html#cb110-67"></a>((p1 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())) <span class="op">/</span><span class="st"> </span>p2) <span class="op">+</span><span class="st"> </span></span>
<span id="cb110-68"><a href="gam.html#cb110-68"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">4</span>, <span class="fl">.6</span>), <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb110-69"><a href="gam.html#cb110-69"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="03-GAM_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="gam.html#cb111-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;Figure2-mp-brms.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">6</span>)</span></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="describe-the-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/digital-wellbeing/steam-lockdown/edit/master/03-GAM.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/digital-wellbeing/steam-lockdown/blob/master/03-GAM.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
